<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Help</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Unauthenticated Notice -->
    <div id="unauthenticated" style="display:none; padding:14px; margin:12px; border:1px solid #e5e7eb; border-radius:8px; background:#fff3cd; color:#8a6d3b;">
        You are not logged in. <a href="signin.html" style="font-weight:600; text-decoration:underline; color:#8a6d3b;">Go to Login</a>. Redirecting...
    </div>
    <div id="main-app" class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="logo.svg" alt="Hostel Help" style="width:34px; height:34px; border-radius:8px; display:inline-block; vertical-align:middle; margin-right:8px;" />
                <h1 style="display:inline-block; vertical-align:middle;">Hostel Help</h1>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="#dashboard" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a></li>
                    <li><a href="#complaints" class="nav-link" data-section="complaints">
                        <i class="fas fa-exclamation-triangle"></i> Submit Complaint
                    </a></li>
                    <li><a href="#resolved" class="nav-link" data-section="resolved">
                        <i class="fas fa-check-circle"></i> Resolved Issues
                    </a></li>
                    <li><a href="#profile" class="nav-link" data-section="profile">
                        <i class="fas fa-user"></i> Profile
                    </a></li>
                    <li id="nav-admin" style="display:none;"><a href="#admin" class="nav-link" data-section="admin">
                        <i class="fas fa-user-shield"></i> Admin
                    </a></li>
                </ul>
            </nav>
            <div class="auth-controls" style="display:flex; align-items:center; gap:10px; margin-left:auto;">
                <span id="current-user-label" class="no-data"></span>
                <button id="logout-btn" class="btn btn-small" style="border:1px solid #ef4444;color:#ef4444;background:transparent;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="section-header">
                    <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                    <p>Welcome to Hostel Help Dashboard</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-complaints">0</h3>
                            <p>Total Complaints</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="pending-complaints">0</h3>
                            <p>Pending</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="resolved-complaints">0</h3>
                            <p>Resolved</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="resolution-rate">0%</h3>
                            <p>Resolution Rate</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="recent-complaints">
                        <h3>Recent Complaints</h3>
                        <div id="recent-complaints-list" class="complaints-list">
                            <p class="no-data">No complaints submitted yet</p>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="showSection('complaints')">
                                <i class="fas fa-plus"></i>
                                Submit New Complaint
                            </button>
                            <button class="action-btn" onclick="showSection('resolved')">
                                <i class="fas fa-list"></i>
                                View All Issues
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Dashboard Footer (Contacts) -->
                <div class="dashboard-contacts" style="margin-top:20px; padding:14px 16px; border:1px solid #e5e7eb; border-radius:10px; background:#f9fafb; color:#374151;">
                    <div style="display:flex; flex-wrap:wrap; gap:18px; align-items:center;">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-phone-alt"></i>
                            <span><strong>Emergency:</strong> <a href="tel:+911122334455" style="color:inherit; text-decoration:underline;">+91 11223 34455</a></span>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-envelope"></i>
                            <span><strong>Hostel Email:</strong> <a href="mailto:hostel.office@example.com" style="color:inherit; text-decoration:underline;">hostel.office@example.com</a></span>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-user-shield"></i>
                            <span><strong>Warden:</strong> <a href="tel:+919876543210" style="color:inherit; text-decoration:underline;">+91 98765 43210</a></span>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-university"></i>
                            <span><strong>College Email:</strong> <a href="mailto:info.college@example.com" style="color:inherit; text-decoration:underline;">info.college@example.com</a></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Complaints Section -->
            <section id="complaints" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Submit Complaint</h2>
                    <p>Report any issues or problems you're experiencing</p>
                </div>
                
                <div class="complaint-form-container">
                    <form id="complaint-form" class="complaint-form">
                        <div class="form-group">
                            <label for="student-name">Student Name</label>
                            <input type="text" id="student-name" name="studentName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="room-number">Room Number</label>
                            <input type="text" id="room-number" name="roomNumber" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="complaint-category">Category</label>
                            <select id="complaint-category" name="category" required>
                                <option value="">Select a category</option>
                                <option value="electrical">Electrical Issues</option>
                                <option value="plumbing">Plumbing Problems</option>
                                <option value="wifi">WiFi/Internet</option>
                                <option value="cleaning">Cleaning & Maintenance</option>
                                <option value="security">Security Concerns</option>
                                <option value="noise">Noise Complaints</option>
                                <option value="furniture">Furniture Issues</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="priority">Priority Level</label>
                            <select id="priority" name="priority" required>
                                <option value="">Select priority</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="complaint-description">Description</label>
                            <textarea id="complaint-description" name="description" rows="5" 
                                placeholder="Please provide detailed description of the issue..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="contact-number">Contact Number</label>
                            <input type="tel" id="contact-number" name="contactNumber" required>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Submit Complaint
                            </button>
                            <button type="reset" class="btn btn-secondary">
                                <i class="fas fa-undo"></i> Reset Form
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Admin Section -->
            <section id="admin" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-user-shield"></i> Admin</h2>
                    <p>Manage all complaints</p>
                </div>
                <div id="admin-role-banner" class="no-data" style="display:none; margin-bottom:10px;"></div>
                <div>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label for="admin-status-filter">Filter by Status:</label>
                            <select id="admin-status-filter">
                                <option value="all">All Issues</option>
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="admin-category-filter">Filter by Category:</label>
                            <select id="admin-category-filter">
                                <option value="all">All Categories</option>
                                <option value="electrical">Electrical</option>
                                <option value="plumbing">Plumbing</option>
                                <option value="wifi">WiFi/Internet</option>
                                <option value="cleaning">Cleaning</option>
                                <option value="security">Security</option>
                                <option value="noise">Noise</option>
                                <option value="furniture">Furniture</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div id="admin-complaints-table" class="complaints-list">
                        <p class="no-data">No complaints found</p>
                    </div>
                </div>
            </section>

            <!-- Resolved Issues Section -->
            <section id="resolved" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-check-circle"></i> Resolved Issues</h2>
                    <p>Track the status of your complaints and resolved issues</p>
                </div>
                
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="status-filter">Filter by Status:</label>
                        <select id="status-filter">
                            <option value="all">All Issues</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="category-filter">Filter by Category:</label>
                        <select id="category-filter">
                            <option value="all">All Categories</option>
                            <option value="electrical">Electrical</option>
                            <option value="plumbing">Plumbing</option>
                            <option value="wifi">WiFi/Internet</option>
                            <option value="cleaning">Cleaning</option>
                            <option value="security">Security</option>
                            <option value="noise">Noise</option>
                            <option value="furniture">Furniture</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div id="complaints-list" class="complaints-list">
                    <p class="no-data">No complaints found</p>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-user"></i> Profile</h2>
                    <p>Manage your account information</p>
                </div>
                
                <div class="profile-container">
                    <div class="profile-info" id="profile-info" style="cursor:pointer;">
                        <div class="profile-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="profile-details">
                            <h3 id="profile-title">Student Profile</h3>
                            <p>Manage your personal information and preferences</p>
                            <div id="profile-quick-details" style="display:none; margin-top:8px;">
                                <p style="margin:2px 0;"><strong>Year:</strong> <span id="qd-year">-</span></p>
                                <p style="margin:2px 0;"><strong>Department:</strong> <span id="qd-department">-</span></p>
                                <p style="margin:2px 0;"><strong>Mobile No.:</strong> <span id="qd-number">-</span></p>
                            </div>
                            <div style="margin-top:10px;">
                                <button id="edit-profile-btn" class="btn btn-primary"><i class="fas fa-edit"></i> Edit Profile</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Complaints:</span>
                            <span class="stat-value" id="profile-total">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Resolved Issues:</span>
                            <span class="stat-value" id="profile-resolved">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Member Since:</span>
                            <span class="stat-value">2024</span>
                        </div>
                    </div>

                    <div class="profile-form" id="profile-form-container" style="margin-top:20px; display:none;">
                        <h3 style="margin-bottom:10px;">Edit Profile</h3>
                        <form id="profile-form">
                            <div class="form-group">
                                <label for="profile-year">College Year</label>
                                <input type="text" id="profile-year" name="year" placeholder="e.g., 1st, 2nd, 3rd, 4th">
                            </div>
                            <div class="form-group">
                                <label for="profile-department">Department</label>
                                <input type="text" id="profile-department" name="department" placeholder="e.g., CS, ECE, IT, MCE">
                            </div>
                            <div class="form-group">
                                <label for="profile-number">Number</label>
                                <input type="tel" id="profile-number" name="number" placeholder="e.g., 9876543210">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Profile</button>
                            </div>
                            <div id="profile-message" class="no-data"></div>
                        </form>
                        <div style="margin-top:16px;">
                            <p><strong>Year:</strong> <span id="display-year">-</span></p>
                            <p><strong>Department:</strong> <span id="display-department">-</span></p>
                            <p><strong>Mobile No.:</strong> <span id="display-number">-</span></p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Success/Error Messages -->
    <div id="message-container" class="message-container"></div>

    <script src="script.js"></script>
    <script>
      // Fallback logout wiring in case main script handler isn't attached
      document.addEventListener('DOMContentLoaded', function() {
        var logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn && !logoutBtn._hmsBound) {
          logoutBtn._hmsBound = true;
          logoutBtn.addEventListener('click', function() {
            try {
              localStorage.removeItem('hms_current_user');
              localStorage.removeItem('hms_user_role');
              localStorage.removeItem('hms_token');
            } catch (e) {}
            window.location.href = 'signin.html';
          });
        }
      });
    </script>
</body>
</html>
